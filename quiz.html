<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Cuestionario interactivo de filosofía. Pon a prueba tus conocimientos.">
    <meta name="keywords" content="filosofía, cuestionario, educación, ética, epistemología, lógica">
    <meta name="author" content="Cuestionarios de Filosofía">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Filosofía Quiz">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🧠</text></svg>">
    
    <title id="page-title">🧠 Cuestionario de Filosofía</title>
    <link rel="stylesheet" href="css/quiz.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>🧠 Cargando cuestionario...</h2>
            <p id="loading-message">Preparando preguntas</p>
            <div class="loading-progress">
                <div class="loading-bar" id="loading-bar"></div>
            </div>
        </div>
    </div>

    <!-- Main Quiz Container -->
    <div id="quiz-container" class="quiz-container hidden">
        <!-- Header -->
        <header class="quiz-header">
            <div class="quiz-nav">
                <button id="back-btn" class="nav-btn">
                    ← Volver a temas
                </button>
                <div class="theme-info">
                    <span id="theme-icon" class="theme-icon">🧠</span>
                    <span id="theme-title" class="theme-title">Filosofía</span>
                </div>
                <button id="help-btn" class="nav-btn">
                    📚 Material
                </button>
            </div>
        </header>

        <!-- Progress Section -->
        <div class="progress-section">
            <div class="progress-info">
                <div class="progress-item">
                    <span class="progress-label">Progreso</span>
                    <span id="question-counter" class="progress-value">1/10</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">Puntaje</span>
                    <span id="score" class="progress-value">0</span>
                </div>
                <div class="progress-item">
                    <span class="progress-label">Tiempo</span>
                    <span id="timer" class="progress-value">30s</span>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>

        <!-- Question Container -->
        <main id="question-container" class="question-container">
            <!-- Help Text Phase -->
            <div id="help-phase" class="phase help-phase">
                <div class="help-content">
                    <h3>💡 Pista</h3>
                    <p id="help-text" class="help-text"></p>
                    <div class="help-actions">
                        <button id="show-question-btn" class="primary-btn">
                            📝 Ver pregunta
                        </button>
                        <div class="spacer">
                            <button id="concept-hunt-btn" class="primary-btn">
                                <!-- <button id="concept-hunt-btn" class="tertiary-btn"> -->
                                    🔎 Caza de conceptos
                                </button>
                                <button id="show-material-btn" class="secondary-btn">
                                    📖 Consultar material
                                </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question Phase -->
            <div id="question-phase" class="phase question-phase hidden">
                <div class="question-content">
                    <h2 id="question-text" class="question-text"></h2>
                    <div id="answers-container" class="answers-container"></div>
                </div>
            </div>

            <!-- Results Phase -->
            <div id="results-phase" class="phase results-phase hidden">
                <div class="results-content">
                    <div class="results-header">
                        <div id="results-icon" class="results-icon">🎉</div>
                        <h2 id="results-title" class="results-title">¡Cuestionario completado!</h2>
                    </div>
                    
                    <div class="results-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="final-score">0</div>
                            <div class="stat-label">Puntaje final</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="correct-answers">0/10</div>
                            <div class="stat-label">Respuestas correctas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-time">0min</div>
                            <div class="stat-label">Tiempo total</div>
                        </div>
                    </div>

                    <div class="results-message" id="results-message">
                        <p>¡Excelente trabajo! Has demostrado un buen dominio del tema.</p>
                    </div>

                    <div class="results-actions">
                        <button id="retry-btn" class="primary-btn">
                            🔄 Intentar de nuevo
                        </button>
                        <button id="themes-btn" class="secondary-btn">
                            🏠 Otros temas
                        </button>
                        <button id="review-btn" class="tertiary-btn">
                            📋 Revisar respuestas
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Study Material Modal -->
    <div id="material-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">📖 Material de Estudio</h3>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Contenido del material se carga aquí -->
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📋 Revisión de Respuestas</h3>
                <button class="close-btn" id="close-review">&times;</button>
            </div>
            <div class="modal-body" id="review-body">
                <!-- Revisión de respuestas se genera aquí -->
            </div>
        </div>
    </div>

    <!-- Error Screen -->
    <div id="error-screen" class="error-screen hidden">
        <div class="error-content">
            <div class="error-icon">❌</div>
            <h2>Error al cargar el cuestionario</h2>
            <p id="error-message">No se pudo cargar el tema seleccionado.</p>
            <button id="retry-load-btn" class="primary-btn">🔄 Reintentar</button>
            <button id="back-to-themes-btn" class="secondary-btn">🏠 Volver a temas</button>
        </div>
    </div>

    <!-- Scripts -->

    <!-- <script>
    const conceptBtn = document.getElementById("concept-hunt-btn");
    if (conceptBtn) {
        conceptBtn.addEventListener("click", () => {
        window.location.href = "caza_conceptos.html?tema=sartre";
        });
    }
    </script> -->

<script>
  const params = new URLSearchParams(location.search);
  const temaActual = params.get('theme') || params.get('tema') || 'sartre';
  sessionStorage.setItem('tema_actual', temaActual);

  const conceptBtn = document.getElementById('concept-hunt-btn');
  if (conceptBtn) {
    conceptBtn.addEventListener('click', () => {
      // pasamos ambos nombres para evitar conflictos
      window.location.href = `caza_conceptos.html?tema=${encodeURIComponent(temaActual)}&theme=${encodeURIComponent(temaActual)}`;
    });
  }
</script>


<script>
  // Shim de parámetros para el quiz
  (function () {
    const params = new URLSearchParams(location.search);
    let tema = params.get('tema')
             || params.get('theme')
             || sessionStorage.getItem('tema_actual')
             || localStorage.getItem('tema_actual')
             || 'sartre'; // valor por defecto para pruebas

    // Garantiza que existan ambos parámetros
    if (!params.get('tema'))  params.set('tema', tema);
    if (!params.get('theme')) params.set('theme', tema);

    // Persiste para futuros "volver"
    sessionStorage.setItem('tema_actual', tema);
    localStorage.setItem('tema_actual', tema);

    // Actualiza la URL antes de que cargue el engine
    const newUrl = location.pathname + '?' + params.toString();
    if (location.search !== '?' + params.toString()) {
      history.replaceState(null, '', newUrl);
    }
  })();
</script>

<script src="js/quiz-engine.js"></script>

</body>
</html>